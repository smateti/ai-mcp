<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Edit Tool</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <div class="container">
        <h1>Edit Tool Descriptions</h1>

        <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

        <form th:action="@{/tools/{id}/update(id=${tool.id})}" method="post">
            <div class="form-group">
                <label for="description">Tool Description (from OpenAPI):</label>
                <textarea id="description" name="description" rows="2" th:text="${tool.description}" readonly style="background-color: #f5f5f5;"></textarea>
                <small>This is the auto-generated description from OpenAPI spec</small>
            </div>

            <div class="form-group">
                <label for="humanReadableDescription">Human-Readable Explanation for AI Models:</label>
                <textarea id="humanReadableDescription" name="humanReadableDescription" rows="4"
                         th:text="${tool.humanReadableDescription}"
                         placeholder="Add a clear explanation of what this tool does, when to use it, and any important context that an AI model should know..."></textarea>
                <small>This helps AI models understand the purpose and usage of this tool</small>
            </div>

            <div class="form-group">
                <label for="baseUrl">Base URL:</label>
                <input type="text" id="baseUrl" name="baseUrl" th:value="${tool.baseUrl}"
                       placeholder="https://api.example.com">
                <small>The base URL for this API endpoint</small>
            </div>

            <div class="section" th:unless="${#lists.isEmpty(tool.rootParameters)}">
                <h2>Parameter Descriptions</h2>
                <p><small>Add human-readable explanations for each parameter to help AI models understand how to use them correctly.</small></p>

                <th:block th:each="parameter : ${tool.rootParameters}">
                    <div class="form-group" th:style="'margin-left: ' + (${parameter.nestingLevel} * 20) + 'px;'">
                        <label th:for="'param_' + ${parameter.id}">
                            <span th:if="${parameter.nestingLevel > 0}">└─ </span>
                            <strong th:text="${parameter.name}"></strong>
                            (<span th:text="${parameter.type}"></span>,
                            <span th:text="${parameter.required ? 'required' : 'optional'}"></span>)
                        </label>

                        <div style="background-color: #f5f5f5; padding: 5px; margin-bottom: 5px; border-radius: 3px;">
                            <small><strong>OpenAPI Description:</strong> <span th:text="${parameter.description != null ? parameter.description : '(no description)'}"></span></small>
                            <br/>
                            <small><strong>OpenAPI Example:</strong> <span th:text="${parameter.example != null ? parameter.example : '(no example)'}"></span></small>
                        </div>

                        <label th:for="'param_desc_' + ${parameter.id}" style="font-weight: normal; font-size: 0.9em;">
                            Human-Readable Description:
                        </label>
                        <input type="hidden" name="paramIds" th:value="${parameter.id}">
                        <textarea th:id="'param_desc_' + ${parameter.id}"
                                 name="paramHumanDescriptions"
                                 rows="2"
                                 th:text="${parameter.humanReadableDescription}"
                                 placeholder="Add a human-readable explanation for AI models..."></textarea>

                        <label th:for="'param_example_' + ${parameter.id}" style="font-weight: normal; font-size: 0.9em; margin-top: 5px;">
                            Custom Example (optional):
                        </label>
                        <input type="hidden" name="paramExampleIds" th:value="${parameter.id}">
                        <input th:id="'param_example_' + ${parameter.id}"
                               name="paramExamples"
                               type="text"
                               th:value="${parameter.example}"
                               placeholder="Add or override example value..."/>
                    </div>

                    <!-- Recursively display nested parameters -->
                    <th:block th:if="${!parameter.nestedParameters.isEmpty()}" th:insert="~{:: nested-parameter-edit(${parameter.nestedParameters})}"></th:block>
                </th:block>
            </div>

            <div class="section" th:unless="${#lists.isEmpty(tool.responses)}">
                <h2>Response Descriptions</h2>
                <p><small>Add human-readable explanations for each response to help AI models understand the output.</small></p>

                <th:block th:each="response : ${tool.responses}">
                    <div class="form-group">
                        <label>
                            <strong>Status Code: <span th:text="${response.statusCode}"></span></strong>
                            (<span th:text="${response.type != null ? response.type : 'no content type'}"></span>)
                        </label>

                        <div style="background-color: #f5f5f5; padding: 5px; margin-bottom: 5px; border-radius: 3px;">
                            <small><strong>OpenAPI Description:</strong> <span th:text="${response.description != null ? response.description : '(no description)'}"></span></small>
                        </div>

                        <label style="font-weight: normal; font-size: 0.9em;">
                            Human-Readable Description:
                        </label>
                        <input type="hidden" name="responseIds" th:value="${response.id}">
                        <textarea name="responseHumanDescriptions"
                                 rows="2"
                                 th:text="${response.humanReadableDescription}"
                                 placeholder="Explain what this response means and when it occurs..."></textarea>
                    </div>
                </th:block>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Save Changes</button>
                <a th:href="@{/tools/{id}(id=${tool.id})}" class="btn btn-secondary">Cancel</a>
            </div>
        </form>

        <!-- Nested parameters recursive edit template -->
        <th:block th:fragment="nested-parameter-edit(params)">
            <th:block th:each="parameter : ${params}">
                <div class="form-group" th:style="'margin-left: ' + (${parameter.nestingLevel} * 20) + 'px;'">
                    <label th:for="'param_desc_' + ${parameter.id}">
                        <span th:if="${parameter.nestingLevel > 0}">└─ </span>
                        <strong th:text="${parameter.name}"></strong>
                        (<span th:text="${parameter.type}"></span>,
                        <span th:text="${parameter.required ? 'required' : 'optional'}"></span>)
                    </label>

                    <div style="background-color: #f5f5f5; padding: 5px; margin-bottom: 5px; border-radius: 3px;">
                        <small><strong>OpenAPI Description:</strong> <span th:text="${parameter.description != null ? parameter.description : '(no description)'}"></span></small>
                        <br/>
                        <small><strong>OpenAPI Example:</strong> <span th:text="${parameter.example != null ? parameter.example : '(no example)'}"></span></small>
                    </div>

                    <label th:for="'param_desc_' + ${parameter.id}" style="font-weight: normal; font-size: 0.9em;">
                        Human-Readable Description:
                    </label>
                    <input type="hidden" name="paramIds" th:value="${parameter.id}">
                    <textarea th:id="'param_desc_' + ${parameter.id}"
                             name="paramHumanDescriptions"
                             rows="2"
                             th:text="${parameter.humanReadableDescription}"
                             placeholder="Add a human-readable explanation for AI models..."></textarea>

                    <label th:for="'param_example_' + ${parameter.id}" style="font-weight: normal; font-size: 0.9em; margin-top: 5px;">
                        Custom Example (optional):
                    </label>
                    <input type="hidden" name="paramExampleIds" th:value="${parameter.id}">
                    <input th:id="'param_example_' + ${parameter.id}"
                           name="paramExamples"
                           type="text"
                           th:value="${parameter.example}"
                           placeholder="Add or override example value..."/>
                </div>
                <th:block th:if="${!parameter.nestedParameters.isEmpty()}" th:insert="~{:: nested-parameter-edit(${parameter.nestedParameters})}"></th:block>
            </th:block>
        </th:block>
    </div>
</body>
</html>
