<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::content})}">
<th:block th:fragment="content">
    <!-- Extract data from JsonNode for easier access -->
    <th:block th:with="upload=${details?.get('upload')},
                       qaPairs=${details?.get('qaPairs')},
                       stats=${details?.get('stats')},
                       status=${details?.get('upload')?.get('status')?.asText()}">

    <!-- Page Header with Breadcrumb -->
    <div class="page-header">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a th:href="@{/documents}">Documents</a></li>
                <li class="breadcrumb-item active">Document Details</li>
            </ol>
        </nav>
        <div class="d-flex justify-content-between align-items-center">
            <h1><i class="bi bi-file-earmark-check me-2"></i>Document Details</h1>
            <span id="statusBadge" class="badge fs-6"
                  th:classappend="${status == 'READY_FOR_REVIEW'} ? 'bg-success' :
                                  (${status == 'FAILED'} ? 'bg-danger' :
                                  (${status == 'MOVED_TO_RAG'} ? 'bg-info' : 'bg-warning'))"
                  th:text="${status ?: 'UNKNOWN'}">STATUS</span>
        </div>
    </div>

    <!-- Processing Progress -->
    <th:block th:replace="~{documents/fragments/_document-info :: processingProgress(${status})}"/>

    <!-- Document Info and Stats -->
    <th:block th:replace="~{documents/fragments/_document-info :: documentInfo(${upload}, ${stats})}"/>

    <!-- Chat Panel -->
    <th:block th:replace="~{documents/fragments/_chat-panel :: chatPanel(${status})}"/>

    <!-- Q&A Table -->
    <th:block th:replace="~{documents/fragments/_qa-table :: qaTable(${qaPairs}, ${status})}"/>

    <!-- Linked Documents Panel -->
    <th:block th:replace="~{documents/fragments/_linked-documents :: linkedDocumentsPanel(${status})}"/>

    <!-- Chunks Panel -->
    <th:block th:replace="~{documents/fragments/_chunks-panel :: chunksPanel(${status})}"/>

    <!-- Status-specific Action Buttons (only one shown based on status) -->
    <th:block th:if="${status == 'READY_FOR_REVIEW'}">
        <th:block th:replace="~{documents/fragments/_action-buttons :: actionsReadyForReview(${uploadId})}"/>
    </th:block>
    <th:block th:if="${status == 'FAILED'}">
        <th:block th:replace="~{documents/fragments/_action-buttons :: actionsFailed(${uploadId}, ${upload})}"/>
    </th:block>
    <th:block th:if="${status == 'MOVED_TO_RAG'}">
        <th:block th:replace="~{documents/fragments/_action-buttons :: actionsMovedToRag}"/>
    </th:block>

    <!-- Generate Q&A Modal -->
    <th:block th:replace="~{documents/fragments/_generate-qa-modal :: generateQaModal}"/>

    <!-- Styles -->
    <th:block th:replace="~{documents/fragments/_preview-styles :: previewStyles}"/>

    <!-- Scripts -->
    <th:block th:replace="~{documents/fragments/_preview-scripts :: previewScripts(${uploadId}, ${sseEndpoint}, ${status})}"/>

    <!-- Linked Documents Scripts -->
    <th:block th:replace="~{documents/fragments/_linked-documents :: linkedDocumentsScripts(${uploadId}, ${@environment.getProperty('naag.services.rag.url', 'http://localhost:8080')})}"/>

    <!-- Chunks Scripts -->
    <th:block th:replace="~{documents/fragments/_chunks-panel :: chunksScripts(${uploadId}, ${@environment.getProperty('naag.services.rag.url', 'http://localhost:8080')})}"/>

    </th:block>
</th:block>
</html>
